<!DOCTYPE html>
<html>

<body>
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <link href="./resources/bootstrap-5.1.3-dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="./resources/bootstrap-5.1.3-dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

  <div class="container">
    <button type="button" class="btn btn-primary" style="margin: 5px;" onclick="btn_send_click()">Start</button>
    <canvas id="myChart" style="width:100%;max-width:700px"></canvas>
  </div>

  <script>
    let ws = new WebSocket("ws://localhost:9000", "callback_rtds");
    var reader = new FileReader();
    var div_mes = document.getElementById("div_messages");
    var xValues = [];
    var i = 0;
    for (i = 0; i < 101; i++) {
      xValues.push(i);
    }
    var yValues = [];
    var chart = new Chart("myChart", {
      type: "line",
      data: {
        labels: xValues,
        datasets: [{
          fill: false,
          lineTension: 0,
          pointRadius: 0,
          backgroundColor: "rgba(0,0,255,1.0)",
          borderColor: "rgba(0,0,255,0.5)",
          data: yValues
        }],
      },
      options: {
        legend: { display: false }
      }
    });

    reader.addEventListener("load", () => {
      if (yValues.length == 75) {
        xValues.shift();
        xValues.push(i);
        i++;
        yValues.shift();
      }
      yValues.push(reader.result);
      chart.update();
    }, false);

    ws.onopen = function () {
      console.log("connected");
    };
    ws.onmessage = function (message) {
      reader.readAsText(message.data);
    };
    ws.onclose = function () {
      console.log("connection closed");
    };

    function btn_send_click() {
      ws.send(JSON.stringify({
        "msg": "Aos"
      }));
    }

  </script>


</body>

</html>